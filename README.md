# spring-security-standard

### Цели:
- Разобраться с базовыми концепциями Spring Security, такими как: SecurityFilterChain, FormLogin, UserDetailsService
- Получить дополнительный опыт взаимодействия с JdbcTemplate 
- Увеличить практический опыт написания тестов

### Технологии:
- Spring Security
- Spring MVC
- JdbcTemplate
- Spring Test

### Концепция:
Доступ к приложению осуществляется через фронт представленный в качестве ряда html-старниц и js-кода. 
Пользователь имеет возможность зарегистрироваться, либо аутентифицироваться. Некоторое время я размышлял на предмет
того, как следует осуществлять взаимодействие аутентифицированного пользователя со страницами для регистрации и аутентификации и 
в конечно итоге пришел к решению, что для упрощение стоит предоставлять доступ к ним только неаутентифицированным пользователям,
а аутентифицированным просто блокировать доступ. В свою очередь аутентифицированные пользователи способны получить доступ к следующим данным: странице 
для юзера, странице для админа, странице для изменения ролей пользователя и информации о пользователе. В свою очередь доступ к
вышеописанным данным дифференцирован в зависимости от роли того, кто запрашивает информацию. Страница для юзера доступна всем аутентифицированным пользователям,
старница для админа доступна пользователям обладающим ролью админ и выше, страница изменения ролей доступна пользователям 
обладающим ролью админа и выше, но чтобы выдать или удалить какую-то роль, пользователю нужно быть обладателем вышестоящий роли, также роли
необходимо добавлять или удалять последовательно, то есть ситуация, в которой у пользователя есть роли USER и SUPERADMIN (без ADMIN), не допустима. 
Информация о пользователе доступна при условии что тот, кто эту информацию запрашивает, обладает вышестоящий ролью. В тех случаях, когда у пользоваетя
недостаточно прав доступа, он, вместо запришиваемых данных, получает страницу отказа в доступе. Также каждый пользователь должен иметь возможность выйти
из системы.

### Компоненты:
- html-страницы
  - login - страница для аутентификации
  - registration - страница для регистрации
  - user, admin - страницы для юзера и админа, по сути, затычки с парой слов 
  - main - содержит ссылки на login, registration, user, admin, а также logout (выход из системы) 
  - access-denied - страница с сообщением о том, что пользователю отказано в доступе
  - user-roles - страница с ролями пользователя и возможностью их менять
- Role - enum представляющий собой роли и ряд операций, которые можно совершать над ними 
- UserDTO - DTO для перемещения информации о пользователи 
- LoadDatabase - конфиг-класс с CommandLineRunner'ом который должен вытащить пользователей из файла
users.json и добавить их в базу до момента старта приложения, а также DataSourceInitializer'ом который 
в тестах позволяет исполнить скрипт schema.sql. Я осведомлен о существовании ряда механизмов которые позволяют 
проделать аналогичные операции проще, но в данном случае просто хотелось ознакомиться с этими механизмами.
- SecurityConfig конфигурация SecurityFilterChain и некоторых вспомогательных объектов
- ***Controller - контроллеры с разными маппингами
- ***ControllerTest - интеграционные тесты, в которых покрываются основные корректные и некорректные сценарии взаимодействия с контроллерами
- BaseAdvice - exceptionHandler для ряда ошибок
- ***Exception - обычные исключения расширяющие RuntimeException, нужны только для упрощение обработки отдельны ошибок exceptionHandler'ом
- UserRowMapper - класс который превращает SqlRowSet в объект UserDTO. Его необходиомсть 
обусловлена тем, что таблица authorities в базе данных при соединении с таблицей users возвращает несколько строк (у одного пользователя может 
быть несколько ролей) и необходимо из несколько строк получить один объект (следовало, конечно, создать дополнительную ManyToMany таблицу, 
но в целях упрощения я этого делать не стал).
- ***Repository - репозитории
- DataCollector - добавляет объект UserDTO в MVC-модель
- RegistrationService - регистрирует пользователей 
- RoleChangeService - меняет роли пользователям 
- RegistrationRequestValidator - при попытке регистрации пользователя проверяет, есть ли пользователь с таким именем, 
если есть, выбрасывает исключение
- RoleChangeValidator - проверяет корректность нового набора ролей и наличие соответствующих 
прав у пользователя, который их пытается изменить
